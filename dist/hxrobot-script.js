var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __commonJS=(cb,mod)=>function(){return mod||(0,cb[Object.keys(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __publicField=(obj,key,value)=>(__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);var require_papaparse_min=__commonJS({"node_modules/papaparse/papaparse.min.js"(exports,module){(function(e,t){typeof define=="function"&&define.amd?define([],t):typeof module=="object"&&typeof exports!="undefined"?module.exports=t():e.Papa=t()})(exports,function s(){"use strict";var f=typeof self!="undefined"?self:typeof window!="undefined"?window:f!==void 0?f:{},n=!f.document&&!!f.postMessage,o=n&&/blob:/i.test((f.location||{}).protocol),a={},h=0,b={parse:function(e,t){var i2=(t=t||{}).dynamicTyping||!1;if(M(i2)&&(t.dynamicTypingFunction=i2,i2={}),t.dynamicTyping=i2,t.transform=!!M(t.transform)&&t.transform,t.worker&&b.WORKERS_SUPPORTED){var r=function(){if(!b.WORKERS_SUPPORTED)return!1;var e2=(i3=f.URL||f.webkitURL||null,r2=s.toString(),b.BLOB_URL||(b.BLOB_URL=i3.createObjectURL(new Blob(["(",r2,")();"],{type:"text/javascript"})))),t2=new f.Worker(e2),i3,r2;return t2.onmessage=_,t2.id=h++,a[t2.id]=t2}();return r.userStep=t.step,r.userChunk=t.chunk,r.userComplete=t.complete,r.userError=t.error,t.step=M(t.step),t.chunk=M(t.chunk),t.complete=M(t.complete),t.error=M(t.error),delete t.worker,void r.postMessage({input:e,config:t,workerId:r.id})}var n2=null;return b.NODE_STREAM_INPUT,typeof e=="string"?n2=t.download?new l(t):new p(t):e.readable===!0&&M(e.read)&&M(e.on)?n2=new g(t):(f.File&&e instanceof File||e instanceof Object)&&(n2=new c(t)),n2.stream(e)},unparse:function(e,t){var n2=!1,_2=!0,m2=",",y2=`\r
`,s2='"',a2=s2+s2,i2=!1,r=null,o2=!1;(function(){if(typeof t=="object"){if(typeof t.delimiter!="string"||b.BAD_DELIMITERS.filter(function(e2){return t.delimiter.indexOf(e2)!==-1}).length||(m2=t.delimiter),(typeof t.quotes=="boolean"||typeof t.quotes=="function"||Array.isArray(t.quotes))&&(n2=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(i2=t.skipEmptyLines),typeof t.newline=="string"&&(y2=t.newline),typeof t.quoteChar=="string"&&(s2=t.quoteChar),typeof t.header=="boolean"&&(_2=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");r=t.columns}t.escapeChar!==void 0&&(a2=t.escapeChar+s2),typeof t.escapeFormulae=="boolean"&&(o2=t.escapeFormulae)}})();var h2=new RegExp(j(s2),"g");if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return u2(null,e,i2);if(typeof e[0]=="object")return u2(r||Object.keys(e[0]),e,i2)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),u2(e.fields||[],e.data||[],i2);throw new Error("Unable to serialize unrecognized input");function u2(e2,t2,i3){var r2="";typeof e2=="string"&&(e2=JSON.parse(e2)),typeof t2=="string"&&(t2=JSON.parse(t2));var n3=Array.isArray(e2)&&0<e2.length,s3=!Array.isArray(t2[0]);if(n3&&_2){for(var a3=0;a3<e2.length;a3++)0<a3&&(r2+=m2),r2+=v2(e2[a3],a3);0<t2.length&&(r2+=y2)}for(var o3=0;o3<t2.length;o3++){var h3=n3?e2.length:t2[o3].length,u3=!1,f2=n3?Object.keys(t2[o3]).length===0:t2[o3].length===0;if(i3&&!n3&&(u3=i3==="greedy"?t2[o3].join("").trim()==="":t2[o3].length===1&&t2[o3][0].length===0),i3==="greedy"&&n3){for(var d2=[],l2=0;l2<h3;l2++){var c2=s3?e2[l2]:l2;d2.push(t2[o3][c2])}u3=d2.join("").trim()===""}if(!u3){for(var p2=0;p2<h3;p2++){0<p2&&!f2&&(r2+=m2);var g2=n3&&s3?e2[p2]:p2;r2+=v2(t2[o3][g2],p2)}o3<t2.length-1&&(!i3||0<h3&&!f2)&&(r2+=y2)}}return r2}function v2(e2,t2){if(e2==null)return"";if(e2.constructor===Date)return JSON.stringify(e2).slice(1,25);o2===!0&&typeof e2=="string"&&e2.match(/^[=+\-@].*$/)!==null&&(e2="'"+e2);var i3=e2.toString().replace(h2,a2),r2=typeof n2=="boolean"&&n2||typeof n2=="function"&&n2(e2,t2)||Array.isArray(n2)&&n2[t2]||function(e3,t3){for(var i4=0;i4<t3.length;i4++)if(-1<e3.indexOf(t3[i4]))return!0;return!1}(i3,b.BAD_DELIMITERS)||-1<i3.indexOf(m2)||i3.charAt(0)===" "||i3.charAt(i3.length-1)===" ";return r2?s2+i3+s2:i3}}};if(b.RECORD_SEP=String.fromCharCode(30),b.UNIT_SEP=String.fromCharCode(31),b.BYTE_ORDER_MARK="\uFEFF",b.BAD_DELIMITERS=["\r",`
`,'"',b.BYTE_ORDER_MARK],b.WORKERS_SUPPORTED=!n&&!!f.Worker,b.NODE_STREAM_INPUT=1,b.LocalChunkSize=10485760,b.RemoteChunkSize=5242880,b.DefaultDelimiter=",",b.Parser=E,b.ParserHandle=i,b.NetworkStreamer=l,b.FileStreamer=c,b.StringStreamer=p,b.ReadableStreamStreamer=g,f.jQuery){var d=f.jQuery;d.fn.parse=function(o2){var i2=o2.config||{},h2=[];return this.each(function(e2){if(!(d(this).prop("tagName").toUpperCase()==="INPUT"&&d(this).attr("type").toLowerCase()==="file"&&f.FileReader)||!this.files||this.files.length===0)return!0;for(var t=0;t<this.files.length;t++)h2.push({file:this.files[t],inputElem:this,instanceConfig:d.extend({},i2)})}),e(),this;function e(){if(h2.length!==0){var e2,t,i3,r,n2=h2[0];if(M(o2.before)){var s2=o2.before(n2.file,n2.inputElem);if(typeof s2=="object"){if(s2.action==="abort")return e2="AbortError",t=n2.file,i3=n2.inputElem,r=s2.reason,void(M(o2.error)&&o2.error({name:e2},t,i3,r));if(s2.action==="skip")return void u2();typeof s2.config=="object"&&(n2.instanceConfig=d.extend(n2.instanceConfig,s2.config))}else if(s2==="skip")return void u2()}var a2=n2.instanceConfig.complete;n2.instanceConfig.complete=function(e3){M(a2)&&a2(e3,n2.file,n2.inputElem),u2()},b.parse(n2.file,n2.instanceConfig)}else M(o2.complete)&&o2.complete()}function u2(){h2.splice(0,1),e()}}}function u(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e2){var t=w(e2);t.chunkSize=parseInt(t.chunkSize),e2.step||e2.chunk||(t.chunkSize=null),this._handle=new i(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e2,t){if(this.isFirstChunk&&M(this._config.beforeFirstChunk)){var i2=this._config.beforeFirstChunk(e2);i2!==void 0&&(e2=i2)}this.isFirstChunk=!1,this._halted=!1;var r=this._partialLine+e2;this._partialLine="";var n2=this._handle.parse(r,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var s2=n2.meta.cursor;this._finished||(this._partialLine=r.substring(s2-this._baseIndex),this._baseIndex=s2),n2&&n2.data&&(this._rowCount+=n2.data.length);var a2=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(o)f.postMessage({results:n2,workerId:b.WORKER_ID,finished:a2});else if(M(this._config.chunk)&&!t){if(this._config.chunk(n2,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);n2=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(n2.data),this._completeResults.errors=this._completeResults.errors.concat(n2.errors),this._completeResults.meta=n2.meta),this._completed||!a2||!M(this._config.complete)||n2&&n2.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),a2||n2&&n2.meta.paused||this._nextChunk(),n2}this._halted=!0},this._sendError=function(e2){M(this._config.error)?this._config.error(e2):o&&this._config.error&&f.postMessage({workerId:b.WORKER_ID,error:e2,finished:!1})}}function l(e){var r;(e=e||{}).chunkSize||(e.chunkSize=b.RemoteChunkSize),u.call(this,e),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e2){this._input=e2,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest,this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),n||(r.onload=v(this._chunkLoaded,this),r.onerror=v(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var e2=this._config.downloadRequestHeaders;for(var t in e2)r.setRequestHeader(t,e2[t])}if(this._config.chunkSize){var i2=this._start+this._config.chunkSize-1;r.setRequestHeader("Range","bytes="+this._start+"-"+i2)}try{r.send(this._config.downloadRequestBody)}catch(e3){this._chunkError(e3.message)}n&&r.status===0&&this._chunkError()}},this._chunkLoaded=function(){r.readyState===4&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:r.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(e2){var t=e2.getResponseHeader("Content-Range");return t===null?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(r),this.parseChunk(r.responseText)))},this._chunkError=function(e2){var t=r.statusText||e2;this._sendError(new Error(t))}}function c(e){var r,n2;(e=e||{}).chunkSize||(e.chunkSize=b.LocalChunkSize),u.call(this,e);var s2=typeof FileReader!="undefined";this.stream=function(e2){this._input=e2,n2=e2.slice||e2.webkitSlice||e2.mozSlice,s2?((r=new FileReader).onload=v(this._chunkLoaded,this),r.onerror=v(this._chunkError,this)):r=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e2=this._input;if(this._config.chunkSize){var t=Math.min(this._start+this._config.chunkSize,this._input.size);e2=n2.call(e2,this._start,t)}var i2=r.readAsText(e2,this._config.encoding);s2||this._chunkLoaded({target:{result:i2}})},this._chunkLoaded=function(e2){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e2.target.result)},this._chunkError=function(){this._sendError(r.error)}}function p(e){var i2;u.call(this,e=e||{}),this.stream=function(e2){return i2=e2,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e2,t=this._config.chunkSize;return t?(e2=i2.substring(0,t),i2=i2.substring(t)):(e2=i2,i2=""),this._finished=!i2,this.parseChunk(e2)}}}function g(e){u.call(this,e=e||{});var t=[],i2=!0,r=!1;this.pause=function(){u.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){u.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e2){this._input=e2,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):i2=!0},this._streamData=v(function(e2){try{t.push(typeof e2=="string"?e2:e2.toString(this._config.encoding)),i2&&(i2=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e3){this._streamError(e3)}},this),this._streamError=v(function(e2){this._streamCleanUp(),this._sendError(e2)},this),this._streamEnd=v(function(){this._streamCleanUp(),r=!0,this._streamData("")},this),this._streamCleanUp=v(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function i(m2){var a2,o2,h2,r=Math.pow(2,53),n2=-r,s2=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,u2=/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/,t=this,i2=0,f2=0,d2=!1,e=!1,l2=[],c2={data:[],errors:[],meta:{}};if(M(m2.step)){var p2=m2.step;m2.step=function(e2){if(c2=e2,_2())g2();else{if(g2(),c2.data.length===0)return;i2+=e2.data.length,m2.preview&&i2>m2.preview?o2.abort():(c2.data=c2.data[0],p2(c2,t))}}}function y2(e2){return m2.skipEmptyLines==="greedy"?e2.join("").trim()==="":e2.length===1&&e2[0].length===0}function g2(){if(c2&&h2&&(k("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+b.DefaultDelimiter+"'"),h2=!1),m2.skipEmptyLines)for(var e2=0;e2<c2.data.length;e2++)y2(c2.data[e2])&&c2.data.splice(e2--,1);return _2()&&function(){if(!c2)return;function e3(e4,t3){M(m2.transformHeader)&&(e4=m2.transformHeader(e4,t3)),l2.push(e4)}if(Array.isArray(c2.data[0])){for(var t2=0;_2()&&t2<c2.data.length;t2++)c2.data[t2].forEach(e3);c2.data.splice(0,1)}else c2.data.forEach(e3)}(),function(){if(!c2||!m2.header&&!m2.dynamicTyping&&!m2.transform)return c2;function e3(e4,t3){var i3,r2=m2.header?{}:[];for(i3=0;i3<e4.length;i3++){var n3=i3,s3=e4[i3];m2.header&&(n3=i3>=l2.length?"__parsed_extra":l2[i3]),m2.transform&&(s3=m2.transform(s3,n3)),s3=v2(n3,s3),n3==="__parsed_extra"?(r2[n3]=r2[n3]||[],r2[n3].push(s3)):r2[n3]=s3}return m2.header&&(i3>l2.length?k("FieldMismatch","TooManyFields","Too many fields: expected "+l2.length+" fields but parsed "+i3,f2+t3):i3<l2.length&&k("FieldMismatch","TooFewFields","Too few fields: expected "+l2.length+" fields but parsed "+i3,f2+t3)),r2}var t2=1;return!c2.data.length||Array.isArray(c2.data[0])?(c2.data=c2.data.map(e3),t2=c2.data.length):c2.data=e3(c2.data,0),m2.header&&c2.meta&&(c2.meta.fields=l2),f2+=t2,c2}()}function _2(){return m2.header&&l2.length===0}function v2(e2,t2){return i3=e2,m2.dynamicTypingFunction&&m2.dynamicTyping[i3]===void 0&&(m2.dynamicTyping[i3]=m2.dynamicTypingFunction(i3)),(m2.dynamicTyping[i3]||m2.dynamicTyping)===!0?t2==="true"||t2==="TRUE"||t2!=="false"&&t2!=="FALSE"&&(function(e3){if(s2.test(e3)){var t3=parseFloat(e3);if(n2<t3&&t3<r)return!0}return!1}(t2)?parseFloat(t2):u2.test(t2)?new Date(t2):t2===""?null:t2):t2;var i3}function k(e2,t2,i3,r2){var n3={type:e2,code:t2,message:i3};r2!==void 0&&(n3.row=r2),c2.errors.push(n3)}this.parse=function(e2,t2,i3){var r2=m2.quoteChar||'"';if(m2.newline||(m2.newline=function(e3,t3){e3=e3.substring(0,1048576);var i4=new RegExp(j(t3)+"([^]*?)"+j(t3),"gm"),r3=(e3=e3.replace(i4,"")).split("\r"),n4=e3.split(`
`),s4=1<n4.length&&n4[0].length<r3[0].length;if(r3.length===1||s4)return`
`;for(var a3=0,o3=0;o3<r3.length;o3++)r3[o3][0]===`
`&&a3++;return a3>=r3.length/2?`\r
`:"\r"}(e2,r2)),h2=!1,m2.delimiter)M(m2.delimiter)&&(m2.delimiter=m2.delimiter(e2),c2.meta.delimiter=m2.delimiter);else{var n3=function(e3,t3,i4,r3,n4){var s4,a3,o3,h3;n4=n4||[",","	","|",";",b.RECORD_SEP,b.UNIT_SEP];for(var u3=0;u3<n4.length;u3++){var f3=n4[u3],d3=0,l3=0,c3=0;o3=void 0;for(var p3=new E({comments:r3,delimiter:f3,newline:t3,preview:10}).parse(e3),g3=0;g3<p3.data.length;g3++)if(i4&&y2(p3.data[g3]))c3++;else{var _3=p3.data[g3].length;l3+=_3,o3!==void 0?0<_3&&(d3+=Math.abs(_3-o3),o3=_3):o3=_3}0<p3.data.length&&(l3/=p3.data.length-c3),(a3===void 0||d3<=a3)&&(h3===void 0||h3<l3)&&1.99<l3&&(a3=d3,s4=f3,h3=l3)}return{successful:!!(m2.delimiter=s4),bestDelimiter:s4}}(e2,m2.newline,m2.skipEmptyLines,m2.comments,m2.delimitersToGuess);n3.successful?m2.delimiter=n3.bestDelimiter:(h2=!0,m2.delimiter=b.DefaultDelimiter),c2.meta.delimiter=m2.delimiter}var s3=w(m2);return m2.preview&&m2.header&&s3.preview++,a2=e2,o2=new E(s3),c2=o2.parse(a2,t2,i3),g2(),d2?{meta:{paused:!0}}:c2||{meta:{paused:!1}}},this.paused=function(){return d2},this.pause=function(){d2=!0,o2.abort(),a2=M(m2.chunk)?"":a2.substring(o2.getCharIndex())},this.resume=function(){t.streamer._halted?(d2=!1,t.streamer.parseChunk(a2,!0)):setTimeout(t.resume,3)},this.aborted=function(){return e},this.abort=function(){e=!0,o2.abort(),c2.meta.aborted=!0,M(m2.complete)&&m2.complete(c2),a2=""}}function j(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function E(e){var S,O=(e=e||{}).delimiter,x=e.newline,I=e.comments,T=e.step,D=e.preview,A=e.fastMode,L=S=e.quoteChar===void 0?'"':e.quoteChar;if(e.escapeChar!==void 0&&(L=e.escapeChar),(typeof O!="string"||-1<b.BAD_DELIMITERS.indexOf(O))&&(O=","),I===O)throw new Error("Comment character same as delimiter");I===!0?I="#":(typeof I!="string"||-1<b.BAD_DELIMITERS.indexOf(I))&&(I=!1),x!==`
`&&x!=="\r"&&x!==`\r
`&&(x=`
`);var F=0,z=!1;this.parse=function(r,t,i2){if(typeof r!="string")throw new Error("Input must be a string");var n2=r.length,e2=O.length,s2=x.length,a2=I.length,o2=M(T),h2=[],u2=[],f2=[],d2=F=0;if(!r)return C();if(A||A!==!1&&r.indexOf(S)===-1){for(var l2=r.split(x),c2=0;c2<l2.length;c2++){if(f2=l2[c2],F+=f2.length,c2!==l2.length-1)F+=x.length;else if(i2)return C();if(!I||f2.substring(0,a2)!==I){if(o2){if(h2=[],k(f2.split(O)),R(),z)return C()}else k(f2.split(O));if(D&&D<=c2)return h2=h2.slice(0,D),C(!0)}}return C()}for(var p2=r.indexOf(O,F),g2=r.indexOf(x,F),_2=new RegExp(j(L)+j(S),"g"),m2=r.indexOf(S,F);;)if(r[F]!==S)if(I&&f2.length===0&&r.substring(F,F+a2)===I){if(g2===-1)return C();F=g2+s2,g2=r.indexOf(x,F),p2=r.indexOf(O,F)}else if(p2!==-1&&(p2<g2||g2===-1))f2.push(r.substring(F,p2)),F=p2+e2,p2=r.indexOf(O,F);else{if(g2===-1)break;if(f2.push(r.substring(F,g2)),w2(g2+s2),o2&&(R(),z))return C();if(D&&h2.length>=D)return C(!0)}else for(m2=F,F++;;){if((m2=r.indexOf(S,m2+1))===-1)return i2||u2.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:h2.length,index:F}),E2();if(m2===n2-1)return E2(r.substring(F,m2).replace(_2,S));if(S!==L||r[m2+1]!==L){if(S===L||m2===0||r[m2-1]!==L){p2!==-1&&p2<m2+1&&(p2=r.indexOf(O,m2+1)),g2!==-1&&g2<m2+1&&(g2=r.indexOf(x,m2+1));var y2=b2(g2===-1?p2:Math.min(p2,g2));if(r[m2+1+y2]===O){f2.push(r.substring(F,m2).replace(_2,S)),r[F=m2+1+y2+e2]!==S&&(m2=r.indexOf(S,F)),p2=r.indexOf(O,F),g2=r.indexOf(x,F);break}var v2=b2(g2);if(r.substring(m2+1+v2,m2+1+v2+s2)===x){if(f2.push(r.substring(F,m2).replace(_2,S)),w2(m2+1+v2+s2),p2=r.indexOf(O,F),m2=r.indexOf(S,F),o2&&(R(),z))return C();if(D&&h2.length>=D)return C(!0);break}u2.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:h2.length,index:F}),m2++}}else m2++}return E2();function k(e3){h2.push(e3),d2=F}function b2(e3){var t2=0;if(e3!==-1){var i3=r.substring(m2+1,e3);i3&&i3.trim()===""&&(t2=i3.length)}return t2}function E2(e3){return i2||(e3===void 0&&(e3=r.substring(F)),f2.push(e3),F=n2,k(f2),o2&&R()),C()}function w2(e3){F=e3,k(f2),f2=[],g2=r.indexOf(x,F)}function C(e3){return{data:h2,errors:u2,meta:{delimiter:O,linebreak:x,aborted:z,truncated:!!e3,cursor:d2+(t||0)}}}function R(){T(C()),h2=[],u2=[]}},this.abort=function(){z=!0},this.getCharIndex=function(){return F}}function _(e){var t=e.data,i2=a[t.workerId],r=!1;if(t.error)i2.userError(t.error,t.file);else if(t.results&&t.results.data){var n2={abort:function(){r=!0,m(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:y,resume:y};if(M(i2.userStep)){for(var s2=0;s2<t.results.data.length&&(i2.userStep({data:t.results.data[s2],errors:t.results.errors,meta:t.results.meta},n2),!r);s2++);delete t.results}else M(i2.userChunk)&&(i2.userChunk(t.results,n2,t.file),delete t.results)}t.finished&&!r&&m(t.workerId,t.results)}function m(e,t){var i2=a[e];M(i2.userComplete)&&i2.userComplete(t),i2.terminate(),delete a[e]}function y(){throw new Error("Not implemented.")}function w(e){if(typeof e!="object"||e===null)return e;var t=Array.isArray(e)?[]:{};for(var i2 in e)t[i2]=w(e[i2]);return t}function v(e,t){return function(){e.apply(t,arguments)}}function M(e){return typeof e=="function"}return o&&(f.onmessage=function(e){var t=e.data;if(b.WORKER_ID===void 0&&t&&(b.WORKER_ID=t.workerId),typeof t.input=="string")f.postMessage({workerId:b.WORKER_ID,results:b.parse(t.input,t.config),finished:!0});else if(f.File&&t.input instanceof File||t.input instanceof Object){var i2=b.parse(t.input,t.config);i2&&f.postMessage({workerId:b.WORKER_ID,results:i2,finished:!0})}}),(l.prototype=Object.create(u.prototype)).constructor=l,(c.prototype=Object.create(u.prototype)).constructor=c,(p.prototype=Object.create(p.prototype)).constructor=p,(g.prototype=Object.create(u.prototype)).constructor=g,b})}});var Papa=require_papaparse_min(),Strategy=class{constructor(strategy2){__publicField(this,"label");__publicField(this,"strategy");__publicField(this,"indicators");__publicField(this,"indicator");__publicField(this,"parameters",[]);__publicField(this,"results",[]);__publicField(this,"infos",{});__publicField(this,"estimateTimeByTest",13e3);__publicField(this,"overloadTime",3e4);__publicField(this,"intervalTime",500);__publicField(this,"jumpTestAfterStart",0);__publicField(this,"jumpTestStack",0);__publicField(this,"jumpTestZeroTrade",!1);__publicField(this,"jumpTestMinusEarning",!1);__publicField(this,"backtestNumber",0);__publicField(this,"backtestTotal",0);__publicField(this,"debug",!1);__publicField(this,"dateStart",0);__publicField(this,"dateEnd",0);typeof strategy2=="string"?this.strategy=document.getElementById(strategy2):typeof strategy2=="number"?this.strategy=document.querySelectorAll(".strategy")[strategy2]:this.strategy=strategy2,this.interfaceDecorator("available"),this.insertLabel(),this.strategy.querySelector(".indicators")||console.error("indicators panel is closed. Opening it before...")}interfaceDecorator(state){switch(state){case"available":this.strategy.style.border="3px dashed rgba(20, 240, 20, 0.8)";break;case"lock":this.strategy.style.border="3px dashed #ff25ab";break;default:break}}insertLabel(){this.strategy.style.position="relative";let label=document.createElement("div");label.style.position="absolute",label.style.color="#fff",label.style.top="30px",label.style.left="0",label.style.backgroundColor="rgba(20, 240, 20, 0.8)",label.style.padding="5px 10px",label.style.zIndex="5",label.classList.add("cr-label"),this.strategy.appendChild(label),this.label=this.strategy.querySelector(".cr-label"),this.setLabel("script loaded")}setLabel(content){this.label.innerHTML=content}updateLabelProgress(){let content=this.backtestNumber/this.backtestTotal*100;content=Number.parseFloat(content).toFixed(1),content+="%";let remainingTime="";if(this.backtestNumber===0)remainingTime=new Date(new Date().getTime()+this.estimateTimeByTest*this.backtestTotal).toLocaleString();else{let estimateTimeByTest=(new Date().getTime()-this.dateStart)/this.backtestNumber;remainingTime=new Date(new Date().getTime()+estimateTimeByTest*(this.backtestTotal-this.backtestNumber)).toLocaleString()}content+=` (${remainingTime})`,this.setLabel(content)}init(options={}){if(!this.strategy.querySelector(".indicators")){console.error("indicators panel is closed. Opening it before...");return}this.reset(),this.options=options,this.indicators=this.strategy.querySelector(".indicators"),this.infos=this.collectInfos(),this.indicator=this.indicators.querySelector(".indicator");let parametersDOM=this.indicator.querySelectorAll(".element"),gap=0;for(let i=0;i<parametersDOM.length;i++)if(parametersDOM[i].style.display==="none")gap++;else{let parameterOptions={};typeof this.options[i-gap]!="undefined"&&(parameterOptions=this.options[i-gap]),this.parameters.push(new Parameter(parametersDOM[i],parameterOptions))}options.jumpTestAfterStart&&(this.jumpTestAfterStart=options.jumpTestAfterStart),options.jumpTestZeroTrade&&(this.jumpTestZeroTrade=!0),options.jumpTestMinusEarning&&(this.jumpTestMinusEarning=!0),options.debug&&(this.debug=options.debug),this.preCalculate()}async start(){this.dateStart=new Date().getTime(),this.startInfo(),this.resetParameters(),await this.validate()||this.saveResults(),await this.backtest(),this.dateEnd=new Date().getTime(),this.endInfo(),this.exportResults()}startInfo(){this.interfaceDecorator("lock"),this.setLabel("100% - starting..."),console.log(`
            --BACKTEST STARTED--
            start time: ${new Date(this.dateStart).toLocaleString()}
            end time (estimate): ${new Date(new Date().getTime()+this.estimateTimeByTest*this.backtestTotal).toLocaleString()}
        `)}endInfo(){this.interfaceDecorator("available"),this.setLabel("100% - finish"),console.log(`
            --BACKTEST END--
            start time: ${new Date(this.dateStart).toLocaleString()}
            end time: ${new Date(this.dateEnd).toLocaleString()}
            tests: ${this.results.length}
            jumped tests: ${this.backtestTotal-this.results.length}
        `)}reset(){this.indicators=this.indicator="",this.parameters=[],this.options={},this.infos={timeframe:"",currency:"",earningCurrency:"",currentIndicator:"",associateIndicator:[]},this.jumpTestAfterStart=0,this.jumpTestStack=0,this.jumpTestZeroTrade=!1,this.jumpTestMinusEarning=!1,this.backtestNumber=0,this.backtestTotal=0,this.debug=!1,this.results=[]}resetParameters(){this.debug&&console.log("-> Strategy reset"),this.parameters.forEach(parameter=>{parameter.reset()})}async validate(){if(this.debug&&console.log("-> Strategy start validate"),await new Promise(resolve=>{setTimeout(()=>{if(this.strategy.querySelector(".overlay").style.display==="none"){console.warn("nothing to validate"),resolve(!1);return}this.strategy.querySelector(".perf .pill.save").click(),resolve(!0)},1e3)}))await this.validateWaiting();else return this.updateLabelProgress(),!1;return this.debug&&console.log("-> Strategy end validate"),this.updateLabelProgress(),!0}async validateWaiting(autoSave=!0){return await new Promise(resolve=>{let interval=setInterval(()=>{let duration=0;if(this.strategy.querySelector(".perf-stats .stat-perf")!==null)return autoSave&&this.saveResults(),resolve(!0),clearInterval(interval),!0;if(this.overloadTime<duration)throw new Error(`overload time (${this.overloadTime/1e3}s), stopping backtests...`);duration+=this.intervalTime},this.intervalTime)})}async backtest(paramIndex=0){if(this.debug&&console.log(`-> Strategy backtest [${paramIndex}]`),this.parameters[paramIndex].options.ignore)paramIndex+1<this.parameters.length?(this.debug&&console.log(`--> parameter[${paramIndex}] ignored, go to parameter[${paramIndex+1}]`),await this.backtest(paramIndex+1)):(this.debug&&console.log(`--> parameter[${paramIndex}] ignored, that last, go validate`),(!this.jumpTestAfterStart||this.jumpTestAfterStart<this.backtestNumber)&&(this.jumpTestStack?this.jumpTestStack--:(await this.validate(),this.checkJumpTest())),this.backtestNumber++);else{this.debug&&console.log(`--> parameter[${paramIndex}] to work x${this.parameters[paramIndex].count}`);for(let i=0;i<this.parameters[paramIndex].count;i++)this.debug&&console.log(`--> parameter[${paramIndex}] in for i = [${i}] set increment`),this.parameters[paramIndex].incrementValue(i),paramIndex+1<this.parameters.length?(this.debug&&console.log(`--> parameter[${paramIndex}] go to parameter[${paramIndex+1}]`),await this.backtest(paramIndex+1)):(this.debug&&console.log(`--> parameter[${paramIndex}] validate`),(!this.jumpTestAfterStart||this.jumpTestAfterStart<this.backtestNumber)&&(this.jumpTestStack?this.jumpTestStack--:(await this.validate(),this.checkJumpTest())),this.backtestNumber++);this.debug&&console.log(`--> parameter[${paramIndex}] reset`),this.parameters[paramIndex].reset()}return this.debug&&console.log(`--> parameter[${paramIndex}] finished`),!0}isJumpableParameter(){for(let i=this.parameters.length-1;i>=0;i--)if(this.parameters[i].type==="slider"&&!this.parameters[i].options.ignore)return this.parameters[i].getCurrent()+this.parameters[i].increment<this.parameters[i].max?i:!1;return!1}checkJumpTest(){if((this.jumpTestZeroTrade||this.jumpTestMinusEarning)&&1<this.results.length){let jumpableParameter=this.isJumpableParameter();jumpableParameter&&(this.jumpTestZeroTrade?this.checkJumpTestZeroTrade(jumpableParameter):this.jumpTestMinusEarning&&this.checkJumpTestMinusEarning())}}checkJumpTestZeroTrade(jumpableParameter){if(this.results[this.results.length-1].trades===0){for(let index=this.parameters[jumpableParameter].getCurrent();index<=this.parameters[jumpableParameter].max;index=this.parameters[jumpableParameter].cleanFloat(index+this.parameters[jumpableParameter].increment))this.jumpTestStack++;this.jumpTestStack--}}checkJumpTestMinusEarning(){let current=this.results[this.results.length-1],previous=this.results[this.results.length-2];current.earning<0&&current.earning<previous.earning&&this.jumpTestStack++}collectInfos(){let indics=[];return document.querySelectorAll(".indicator-title .name:not(.selected)").forEach(indic=>indics.push(indic.outerText)),{timeframe:document.querySelector(".contests .choice2.selected").outerText.trim(),currency:document.querySelector(".contests .choice3.selected").outerText.trim(),earningCurrency:document.querySelector(".category-rm .vue-js-switch.toggled")?"BTC":"HXRO",currentIndicator:this.indicators.querySelector(".indicator-title .name.selected").outerText.trim(),associateIndicator:indics}}preCalculate(){this.backtestTotal=1;let countCursor=0;this.parameters.forEach(parameter=>{parameter.options.ignore||(this.backtestTotal*=parameter.count,countCursor+=parameter.count)});let totalTime=this.estimateTimeByTest*this.backtestTotal,evalIndicator,evalCountTest,evalEstimateDuringTime,evalEstimateEndingTime;if(0<this.jumpTestAfterStart){let countRemainingTest=this.backtestTotal-this.jumpTestAfterStart,remainingTime=totalTime-this.jumpTestAfterStart*this.estimateTimeByTest;evalIndicator=`${this.infos.currentIndicator} (${this.parameters.length} parameters with ${countCursor} cursors)`,evalCountTest=`${countRemainingTest} (total: ${this.backtestTotal} // jump to: ${this.jumpTestAfterStart})`,evalEstimateDuringTime=`${this.msToTime(remainingTime)} (total: ${this.msToTime(totalTime)})`,evalEstimateEndingTime=`${new Date(new Date().getTime()+remainingTime).toLocaleString()}`}else evalIndicator=`${this.infos.currentIndicator} (${this.parameters.length} parameters with ${countCursor} cursors)`,evalCountTest=`${this.backtestTotal}`,evalEstimateDuringTime=`${this.msToTime(totalTime)}`,evalEstimateEndingTime=`${new Date(new Date().getTime()+totalTime).toLocaleString()}`;this.setLabel(`ready to start : ${evalEstimateEndingTime}`),console.log(`
            --BACKTEST EVALUATION--
            indicator: ${evalIndicator}
            number of tests: ${evalCountTest}
            estimate time to full backtest indicator: ${evalEstimateDuringTime}
            estimate ending time: ${evalEstimateEndingTime}
            (option) debug: ${this.debug}
            (option) jumpTestAfterStart: ${this.jumpTestAfterStart}
            (option) jumpTestZeroTrade: ${this.jumpTestZeroTrade}
            (option) jumpTestMinusEarning: ${this.jumpTestMinusEarning}
        `)}saveResults(){this.debug&&console.log("-> Strategy save results");let additionalData=[];additionalData.date=new Date().toLocaleString(),this.results.push({...additionalData,...this.getPerfData(),...this.getParamData()})}exportResults(){this.debug&&console.log("-> Strategy export results");let filename=`${new Date().toISOString().slice(0,10)}_${this.infos.currentIndicator}-${this.infos.currency}-${this.infos.timeframe}.csv`,csv=Papa.unparse(this.results),blob=new Blob([csv]),a=window.document.createElement("a");a.href=window.URL.createObjectURL(blob,{type:"text/plain"}),a.download=filename,document.body.appendChild(a),a.click(),document.body.removeChild(a)}getPerfData(){let perfPanel=this.strategy.querySelectorAll(".perf-stats .stat-perf"),perfData=[];return perfData.earning=parseFloat(perfPanel[0].querySelectorAll("div")[1].childNodes[0].nodeValue.trim().replace(/[^\d.-]/g,"")),perfData.winrate=parseFloat(perfPanel[2].querySelector(".number").outerText.replace(/[^\d.-]/g,"")),perfData.payout=parseFloat(perfPanel[3].querySelector(".number").outerText.replace(/[^\d.-]/g,"")),perfData.drawdown=parseFloat(perfPanel[5].querySelector(".number").outerText),perfData.ratio=parseFloat(0<perfData.earning?perfData.earning/(Math.abs(perfData.drawdown)!==0?Math.abs(perfData.drawdown):1):0).toFixed(2),perfData.trades=parseInt(perfPanel[6].querySelector(".number").outerText),perfData.winstreak=parseInt(perfPanel[7].querySelector(".number").outerText),perfData.losestreak=parseInt(perfPanel[8].querySelector(".number").outerText),perfData.pool=parseInt(perfPanel[4].querySelector(".number").outerText),perfData}getParamData(){let paramData=[];return this.parameters.forEach(parameter=>{paramData[parameter.name]=parameter.getCurrent()}),paramData}msToTime(ms){let seconds=(ms/1e3).toFixed(1),minutes=(ms/(1e3*60)).toFixed(1),hours=(ms/(1e3*60*60)).toFixed(1),days=(ms/(1e3*60*60*24)).toFixed(1);return seconds<60?seconds+" Sec":minutes<60?minutes+" Min":hours<24?hours+" Hrs":days+" Days"}debug(){console.log("--INDICATOR: "+this.infos.currentIndicator+`
countParameters: `+this.parameters.length),this.parameters.forEach(parameter=>{parameter.debug()})}},Parameter=class{constructor(elementDOM,options={}){__publicField(this,"parameterDOM");__publicField(this,"name");__publicField(this,"type");__publicField(this,"sliderDOM");__publicField(this,"sliderDotDOM");__publicField(this,"inputDOM");__publicField(this,"current");__publicField(this,"min");__publicField(this,"max");__publicField(this,"increment");__publicField(this,"switchDOM");__publicField(this,"count");__publicField(this,"options");__publicField(this,"optionsDefault",{ignore:!1,min:"auto",max:"auto",increment:"auto"});__publicField(this,"countMaxIncrement",10);__publicField(this,"incrementDecimals",0);this.parameterDOM=elementDOM,this.name=this.parameterDOM.querySelector(".element-title").outerText,this.parameterDOM.querySelector(".input-false")?this.optionalSliderInit(options):this.parameterDOM.querySelector(".vue-js-switch")?this.switchInit(options):this.parameterDOM.querySelector(".vue-slider")?this.sliderInit(options):this.parameterDOM.querySelector("select.option")?this.selectInit(options):(console.error("unknown parameter"),console.error(this.parameterDOM))}reset(){if(!this.options.ignore)switch(this.type){case"switch":this.switchReset();break;case"slider":this.sliderReset();break;case"select":this.selectReset();break;case"optionalSlider":break}}debug(){switch(this.type){case"switch":this.switchDebug();break;case"slider":this.sliderDebug();break;case"select":this.selectDebug();break;case"optionalSlider":break}}getCurrent(){switch(this.type){case"switch":return this.switchDOM.classList.contains("toggled");case"slider":return parseFloat(this.sliderDotDOM.getAttribute("aria-valuenow"));case"select":return this.selectDOM.selectedIndex;case"optionalSlider":}}incrementValue(cursor){if(!this.options.ignore)switch(this.type){case"switch":this.switchSetValue(Boolean(cursor));break;case"slider":this.sliderIncrement(cursor);break;case"select":this.selectIncrement(cursor);break;case"optionalSlider":break}}sliderInit(options={}){if(this.type="slider",this.sliderDOM=this.parameterDOM.querySelector(".vue-slider"),this.sliderDotDOM=this.parameterDOM.querySelector(".vue-slider-dot"),this.inputDOM=this.parameterDOM.querySelector("input"),this.options={...this.optionsDefault,...options},this.inputDOM?(this.min=parseFloat(this.inputDOM.getAttribute("min")),this.max=parseFloat(this.inputDOM.getAttribute("max")),this.increment=parseFloat(this.inputDOM.getAttribute("step"))):(this.min=parseFloat(this.sliderDotDOM.getAttribute("aria-valuemin")),this.max=parseFloat(this.sliderDotDOM.getAttribute("aria-valuemax")),this.increment=1),(this.options.min||this.options.min===0)&&(this.options.min<this.min||this.max<this.options.min?console.warn(`
                    parameter: '${this.name}'
                    'min' options at '${this.options.min}' must between '${this.min}' and '${this.max}'
                    (option ignored)
                `):this.options.min==="auto"?this.min=this.min+this.increment:this.min=this.options.min),(this.options.max||this.options.max===0)&&(this.max<this.options.max||this.options.max<this.min?console.warn(`
                    parameter: '${this.name}'
                    'max' options at '${this.options.max}' must between '${this.min}' and '${this.max}'
                    (option ignored)
                `):this.options.max==="auto"?this.max=this.max-this.increment:this.max=this.options.max),this.options.increment||this.options.increment===0)if(this.max<this.options.increment||this.options.increment<this.increment)console.warn(`
                    parameter: '${this.name}'
                    'increment' options '${this.options.increment}' isn't set correctly (increment: ${this.increment})
                    (option ignored)
                `);else if(this.options.increment==="auto"){let countIncrement=(this.max-this.min+this.increment)/this.increment;this.countMaxIncrement<countIncrement&&(this.increment=Math.round(countIncrement/this.countMaxIncrement)*this.increment)}else this.increment=this.options.increment;this.incrementDecimals=this.countDecimals(this.increment),this.count=0;for(let index=this.min;index<=this.max;index=this.cleanFloat(index+this.increment))this.count++}sliderReset(){if(this.type!=="slider")return!1;this.getCurrent()!==this.min&&this.sliderSetValue(this.min)}sliderSetValue(value){if(this.type!=="slider")return!1;this.sliderDOM.__vue__.setValue(value)}sliderDebug(){console.log("--PARAMETER: "+this.name+`
type: `+this.type+`
min: `+this.min+`
max: `+this.max+`
increment: `+this.increment+`
count: `+this.count),console.log(this.sliderDOM)}sliderIncrement(cursor="auto"){let incrementalValue=0;cursor==="auto"?incrementalValue=this.getCurrent()+this.increment:incrementalValue=this.min+this.increment*cursor,incrementalValue=this.cleanFloat(incrementalValue),incrementalValue<=this.max?this.sliderSetValue(incrementalValue):console.warn(`bad increment ${this.getCurrent()} + ${this.increment} for a max ${this.max} (${this.name})`)}switchInit(options={}){this.type="switch",this.count=2,this.switchDOM=this.parameterDOM.querySelector(".vue-js-switch"),this.options={...this.optionsDefault,...options},typeof options.min!="undefined"&&console.warn(`
                parameter: '${this.name}'
                'min' options at '${options.min}' isn't supported on switch
                (option ignored)
            `),typeof options.max!="undefined"&&console.warn(`
                parameter: '${this.name}'
                'max' options at '${options.max}' isn't supported on switch
                (option ignored)
            `),typeof options.increment!="undefined"&&console.warn(`
                parameter: '${this.name}'
                'increment' options '${options.increment}' isn't supported on switch
                (option ignored)
            `)}switchReset(){if(this.type!=="switch")return!1;this.switchSetValue(!1)}switchSetValue(value="auto"){if(this.type!=="switch")return!1;(value==="auto"||value&&!this.switchDOM.classList.contains("toggled")||!value&&this.switchDOM.classList.contains("toggled"))&&this.switchDOM.click()}switchDebug(){console.log("--PARAMETER: "+this.name+`
type: `+this.type+`
current: `+this.getCurrent()+`
count: `+this.count),console.log(this.switchDOM)}selectInit(options={}){this.type="select",this.selectDOM=this.parameterDOM.querySelector("select.option"),this.count=this.selectDOM.querySelectorAll("option").length,this.options={...this.optionsDefault,...options},this.min=0,this.max=this.count,this.increment=1}selectReset(){if(this.type!=="select")return!1;this.selectSetValue(this.min)}selectSetValue(value){if(this.type!=="select")return!1;this.selectDOM.selectedIndex=parseInt(value);let evt=document.createEvent("HTMLEvents");evt.initEvent("change",!1,!0),this.selectDOM.dispatchEvent(evt)}selectDebug(){console.log("--PARAMETER: "+this.name+`
type: `+this.type+`
current: `+this.getCurrent()+`
count: `+this.count),console.log(this.selectDOM)}selectIncrement(cursor){let incrementalValue=this.min+this.increment*cursor;incrementalValue<=this.max?this.selectSetValue(incrementalValue):console.warn(`bad select increment ${this.getCurrent()} + ${this.increment} for a max ${this.max} (${this.name})`)}optionalSliderInit(){}optionalSliderReset(){}optionalSliderSetValue(){}optionalSliderDebug(){}optionalSliderIncrement(){}cleanFloat(floatNumber){return floatNumber=floatNumber.toFixed(this.incrementDecimals),parseFloat(floatNumber)}countDecimals(value){return Math.floor(value)===value?0:value.toString().split(".")[1].length||0}},strategy=new Strategy(0);
/* @license
Papa Parse
v5.3.1
https://github.com/mholt/PapaParse
License: MIT
*/
